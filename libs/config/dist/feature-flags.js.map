{"version":3,"sources":["../src/feature-flags.ts"],"sourcesContent":["import type {\n  FeatureFlag,\n  FeatureFlagConfig,\n  FeatureFlagMap,\n} from '@multi-tenancy/types';\nimport { FEATURE_FLAGS } from '@multi-tenancy/types';\n\n/**\n * Default feature flag configuration\n */\nconst defaultFeatureFlags: FeatureFlagConfig[] = [\n  { flag: FEATURE_FLAGS.DARK_MODE, enabled: true },\n  { flag: FEATURE_FLAGS.ADVANCED_SEARCH, enabled: false },\n  { flag: FEATURE_FLAGS.BULK_OPERATIONS, enabled: false },\n  { flag: FEATURE_FLAGS.ANALYTICS_DASHBOARD, enabled: false },\n  { flag: FEATURE_FLAGS.CUSTOM_BRANDING, enabled: true },\n  { flag: FEATURE_FLAGS.API_ACCESS, enabled: false },\n  { flag: FEATURE_FLAGS.SSO_LOGIN, enabled: false },\n  { flag: FEATURE_FLAGS.AUDIT_LOGS, enabled: false },\n];\n\n/**\n * Resolves feature flags for a specific tenant\n */\nexport function resolveFeatureFlags(\n  tenantId: string,\n  tenantFeatures: FeatureFlag[] = [],\n  configOverrides: FeatureFlagConfig[] = []\n): FeatureFlagMap {\n  // Start with all flags disabled\n  const result = Object.values(FEATURE_FLAGS).reduce((acc, flag) => {\n    acc[flag] = false;\n    return acc;\n  }, {} as FeatureFlagMap);\n\n  // Apply default configuration\n  for (const config of defaultFeatureFlags) {\n    if (config.enabled) {\n      // Check tenant restrictions\n      if (config.blockedTenants?.includes(tenantId)) continue;\n      if (config.allowedTenants && !config.allowedTenants.includes(tenantId))\n        continue;\n\n      result[config.flag] = true;\n    }\n  }\n\n  // Apply config overrides\n  for (const config of configOverrides) {\n    if (config.blockedTenants?.includes(tenantId)) {\n      result[config.flag] = false;\n      continue;\n    }\n    if (config.allowedTenants && !config.allowedTenants.includes(tenantId)) {\n      result[config.flag] = false;\n      continue;\n    }\n    result[config.flag] = config.enabled;\n  }\n\n  // Apply tenant-specific features (these always win)\n  for (const feature of tenantFeatures) {\n    result[feature] = true;\n  }\n\n  return result;\n}\n\n/**\n * Type-safe feature flag checker\n */\nexport function createFeatureFlagChecker(flags: FeatureFlagMap) {\n  return function isFeatureEnabled(flag: FeatureFlag): boolean {\n    return flags[flag] ?? false;\n  };\n}\n\n/**\n * Checks if a feature is enabled\n */\nexport function isFeatureEnabled(\n  flags: FeatureFlagMap,\n  flag: FeatureFlag\n): boolean {\n  return flags[flag] ?? false;\n}\n"],"names":["FEATURE_FLAGS","defaultFeatureFlags","flag","DARK_MODE","enabled","ADVANCED_SEARCH","BULK_OPERATIONS","ANALYTICS_DASHBOARD","CUSTOM_BRANDING","API_ACCESS","SSO_LOGIN","AUDIT_LOGS","resolveFeatureFlags","tenantId","tenantFeatures","configOverrides","result","Object","values","reduce","acc","config","blockedTenants","includes","allowedTenants","feature","createFeatureFlagChecker","flags","isFeatureEnabled"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAKA,SAASA,aAAa,QAAQ,uBAAuB;AAErD;;CAEC,GACD,MAAMC,sBAA2C;IAC/C;QAAEC,MAAMF,cAAcG,SAAS;QAAEC,SAAS;IAAK;IAC/C;QAAEF,MAAMF,cAAcK,eAAe;QAAED,SAAS;IAAM;IACtD;QAAEF,MAAMF,cAAcM,eAAe;QAAEF,SAAS;IAAM;IACtD;QAAEF,MAAMF,cAAcO,mBAAmB;QAAEH,SAAS;IAAM;IAC1D;QAAEF,MAAMF,cAAcQ,eAAe;QAAEJ,SAAS;IAAK;IACrD;QAAEF,MAAMF,cAAcS,UAAU;QAAEL,SAAS;IAAM;IACjD;QAAEF,MAAMF,cAAcU,SAAS;QAAEN,SAAS;IAAM;IAChD;QAAEF,MAAMF,cAAcW,UAAU;QAAEP,SAAS;IAAM;CAClD;AAED;;CAEC,GACD,OAAO,SAASQ,oBACdC,QAAgB,EAChBC,iBAAgC,EAAE,EAClCC,kBAAuC,EAAE;IAEzC,gCAAgC;IAChC,MAAMC,SAASC,OAAOC,MAAM,CAAClB,eAAemB,MAAM,CAAC,CAACC,KAAKlB;QACvDkB,GAAG,CAAClB,KAAK,GAAG;QACZ,OAAOkB;IACT,GAAG,CAAC;IAEJ,8BAA8B;IAC9B,KAAK,MAAMC,UAAUpB,oBAAqB;QACxC,IAAIoB,OAAOjB,OAAO,EAAE;gBAEdiB;YADJ,4BAA4B;YAC5B,KAAIA,yBAAAA,OAAOC,cAAc,qBAArBD,uBAAuBE,QAAQ,CAACV,WAAW;YAC/C,IAAIQ,OAAOG,cAAc,IAAI,CAACH,OAAOG,cAAc,CAACD,QAAQ,CAACV,WAC3D;YAEFG,MAAM,CAACK,OAAOnB,IAAI,CAAC,GAAG;QACxB;IACF;IAEA,yBAAyB;IACzB,KAAK,MAAMmB,UAAUN,gBAAiB;YAChCM;QAAJ,KAAIA,0BAAAA,OAAOC,cAAc,qBAArBD,wBAAuBE,QAAQ,CAACV,WAAW;YAC7CG,MAAM,CAACK,OAAOnB,IAAI,CAAC,GAAG;YACtB;QACF;QACA,IAAImB,OAAOG,cAAc,IAAI,CAACH,OAAOG,cAAc,CAACD,QAAQ,CAACV,WAAW;YACtEG,MAAM,CAACK,OAAOnB,IAAI,CAAC,GAAG;YACtB;QACF;QACAc,MAAM,CAACK,OAAOnB,IAAI,CAAC,GAAGmB,OAAOjB,OAAO;IACtC;IAEA,oDAAoD;IACpD,KAAK,MAAMqB,WAAWX,eAAgB;QACpCE,MAAM,CAACS,QAAQ,GAAG;IACpB;IAEA,OAAOT;AACT;AAEA;;CAEC,GACD,OAAO,SAASU,yBAAyBC,KAAqB;IAC5D,OAAO,SAASC,iBAAiB1B,IAAiB;YACzCyB;QAAP,OAAOA,CAAAA,cAAAA,KAAK,CAACzB,KAAK,YAAXyB,cAAe;IACxB;AACF;AAEA;;CAEC,GACD,OAAO,SAASC,iBACdD,KAAqB,EACrBzB,IAAiB;QAEVyB;IAAP,OAAOA,CAAAA,cAAAA,KAAK,CAACzB,KAAK,YAAXyB,cAAe;AACxB"}